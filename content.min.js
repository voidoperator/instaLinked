function checkProfileAndProcess(e=null){const t=window.location.href;if(/^https:\/\/www\.linkedin\.com\/in\/[^/]+\/?$/.test(t)){const t=extractVariables({FullName:"",FirstName:"",LastName:"",CompanyName:"",PositionName:""});e&&e.postMessage({success:!0,action:"variablesResponse",variables:t})}else e&&e.postMessage({success:!1,action:"variablesResponse",variables:{}})}function extractVariables(e){const t=document.querySelector(".pv-text-details__left-panel > div:first-child > h1");if(t){const n=t.innerText.trim().replace(/\(.*?\)/g,"").replace(/[^a-zA-Z\s]+|(\b[A-Z]+\b)/g,"").replace(/\s+/g," ").trim(),s=n.split(" ")[0],i=n.split(" ")[1];e.FullName=n,e.FirstName=s,e.LastName=i}const n=document.getElementById("experience").nextElementSibling.nextElementSibling;if(n){const t=document.querySelector('a[data-field="experience_company_logo"] > div > div > img');t&&(e.CompanyName=t.alt.split(" ").slice(0,-1).join(" "));const s=n.querySelector("ul.pvs-list > li > div > div:nth-child(2) > div > div > div > span > span:first-child");s&&(e.PositionName=s.innerText)}return e}async function autoSendMessage(e){const t=document.querySelector('li-icon[type="connect"]');let n;try{await t.click();(await waitForElement('button[aria-label="Add a note"]')).click();const s=await waitForElement('textarea[id="custom-message"]');s.value=e,s.dispatchEvent(new Event("input",{bubbles:!0})),n=s}catch(e){console.log("Oops something went wrong: ",e)}return new Promise((e=>{n.value.length>0?e(!0):e(!1)}))}function waitForElement(e){return new Promise((t=>{const n=document.querySelector(e);n&&!n.disabled&&null!==n.offsetParent&&t(n);const s=new MutationObserver((n=>{n.forEach((n=>{const i=Array.from(n.addedNodes);for(const n of i)n.matches&&n.matches(e)&&!n.disabled&&null!==n.offsetParent&&(s.disconnect(),t(n))}))}));s.observe(document.body,{childList:!0,subtree:!0})}))}chrome.runtime.onConnect.addListener((function(e){"popup"===e.name&&e.onMessage.addListener((function(t){"requestVariables"===t.action&&checkProfileAndProcess(e)}))})),chrome.runtime.onMessage.addListener((async e=>{if("autoSendMessage"===e.action){const t=await autoSendMessage(e.finalTemplateMessage);return chrome.runtime.sendMessage({action:"autoSendResult",success:t}),!0}})),chrome.runtime.onMessage.addListener(((e,t,n)=>{if("requestVariables"===e.action)return checkProfileAndProcess(n),!0})),window.addEventListener("popstate",(function(){const e=window.location.href;/^https:\/\/www\.linkedin\.com\/in\/[^/]+\/?$/.test(e)&&checkProfileAndProcess()}));